<!DOCTYPE html>
<html>
  <head>
    <title><%= "JK Games - " + yield(:title) %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

    <%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>
    <%= stylesheet_link_tag 'application', 'data-turbolinks-track': 'reload' %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="bg-secondary text-white">
      <%= render "shared/navbar" %>
      <!-- <%= debug session[:shopping_cart] %> -->

        <% if flash[:notice] %>
          <p>
            <%= flash[:notice] %>
          </p>
        <% end %>

      <!-- navigation partial -->
      <nav>
        <ul class="nav">
          <li class="nav-item">
            <a class="nav-link" href="#">
              Cart
              <% if session[:shopping_cart].present? %>
                <p>has <%= session[:shopping_cart].sum { |_, details| details['quantity'].to_i } %> items.</p>
                <div class="cart-dropdown">
                  <ul class="list-group">
                    <% session[:shopping_cart].each do |id, details| %>
                      <li class="list-group-item">
                        <%= link_to details['title'], game_path(id) %>
                        <p>Quantity: <%= details['quantity'] %></p>
                        <p>$<%= details['price'] %>CAD</p>
                        <%= button_to 'Remove', cart_path(id), method: :delete, class: 'btn btn-danger btn-sm float-end' %>
                      </li>
                    <% end %>
                  </ul>
                </div>
              <% end %>
            </a>
          </li>
        </ul>
      </nav>



        <%= link_to 'View your cart', cart_show_path %>


      <%= render "shared/search_bar" %>
    <%= yield %>
  </body>
</html>
